<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/CadCliente.css">
    <link rel="shortcut icon" href="../IMG/Group 5.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <title>ConectaBov</title>
</head>

<body>
  <div class="cabecalho">
    <div class="cabecalho-div-">
        <div class="cabecalho-div-login">
            <img src="/IMG/Group 5.png" width="80px" class="imgLogo">      
                <div class="cabecalho-div">
                    <!-- Ícone para abrir o menu -->
                    <!-- Ícone para abrir o menu -->
                    
                    <!-- Menu lateral com botão de fechar -->
                    <div id="menuLateral" class="menu-lateral">
                        <button class="fechar-menu" onclick="fecharMenu()">← Voltar</button>
                        <ul>
                            <li>
                                <a href="servicos.html">
                                    <img src="/IMG/cardapio 2.png" alt="Início" class="icon"> Início
                                </a>
                            </li>
                            <li>
                                <a href="cadastroAnimal.html">
                                    <img src="/IMG/cadastro 2.png" alt="Cadastro" class="icon"> Cadastro
                                </a>
                            </li>
                            <li>
                                <a href="consultaMensal.html">
                                    <img src="/IMG/pesquisa 2.png" alt="Consulta Mensal" class="icon"> Consulta
                                    Mensal
                                </a>
                            </li>
                            <li>
                                <a href="/public/CLimaAPI.html">
                                    <img src="/IMG/dia-ensolarado 2.png" alt="Clima" class="icon"> Clima
                                </a>
                            </li>
                         
                            <li>
                                <a href="veterinarios.html">
                                    <img src="/IMG/vaca 2.png" alt="Veterinários" class="icon"
                                        style="width: 50px;margin-left: -6px;"> Veterinários
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="logout()" style="display: flex; align-items: center;">
                                    ←  Sair
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
       

         

            <a href="perfil.html" class="icon-login"><img class="user-solid" src="/IMG/user-solid.svg" alt="" srcset="" width="30px">
               
            </a>
        </div>
        
        <div class="menu">
            <img src="/IMG/bars-solid-full.svg" alt="" width="35px" onclick="abrirMenu()">
            <p>Bem vindo a ConectaBov</p>
        </div>

        <div class="chat-container">
          <!-- Botão aparece só quando o chat está fechado -->
          <button class="chat-btn" id="chatBtn">
            <img src="../img/scarecrow (1) 1.png" alt="Chat ConectaBov">
          </button>
        
          <!-- Caixa de chat escondida inicialmente -->
          <div class="chat-box" id="chatBox">
            <div class="chat-header">
              ConectaBov I.A
              <span class="close-chat" id="closeChat">✖</span>
            </div>
            <div class="chat-messages" id="chatMessages">
              <p class="bot-msg">Olá! Eu sou a I.A da ConectaBov, como posso ajudar?</p>
            </div>
            <div class="chat-input">
              <input type="text" id="userInput" placeholder="Digite sua mensagem...">
              <button id="sendBtn">➤</button>
            </div>
          </div>
        </div>

         
          
        <div class="dashboard">
          <div class="dashboard-children">
              <div class="tituloCadastroGeral">
                  <img src="/IMG/pesquisa 2.png" alt="" width="45px" class="tituloCadastroGeralImg">Cadastro
                  
              </div>

              <div class="cadastroBox">
                  <div class="cadastroBox1">
                      <img src="../IMG/vaca (1) 1.png" alt="" width="50px">
                      <span style="color: #465640; font-weight: bold; font-size: 35px; margin-left: 10px;"> Cliente
                         </span>
                  </div>
                  <form action="" method="" id="formCliente">
                      <div class="area">
                          <input type="text" name="nome" id="" required class="campoCadastro input"
                              placeholder=" Nome Completo">
                          <div class="labelline">Nome Completo</div>
                      </div>

                      <div class="area">
                          <input type="date" name="dataNascimento" id="" required class="campoCadastro input">
                          <div class="labelline">Data de Nascimento</div>
                      </div>

                      <div class="area">
                          <input type="text" name="cnpj" id="" required class="campoCadastro input"
                              placeholder=" CNPJ">
                          <div class="labelline">CNPJ</div>
                      </div>

                      <div class="area">
                          <input type="text" name="cpf" id="" required class="campoCadastro input"
                              placeholder=" CPF">
                          <div class="labelline">CPF</div>
                      </div>

                      <div class="area">
                          <input type="text" name="telefone" id="" required class="campoCadastro input"
                              placeholder=" Telefone">
                          <div class="labelline">Telefone</div>
                      </div>

                      <div class="area">
                          <input type="text" name="ocupacao" id="" required class="campoCadastro input"
                              placeholder=" Ocupação">
                          <div class="labelline">Ocupação</div>
                      </div>

                      <div class="area">
<input type="file" name="imagem" id="foto" required class="campoCadastro input" accept="image/*">
<div class="labelline">Foto do Perfil</div>
</div>
<div class="area">
                      </div>
                      

                      <div class="botaoContainer">
                          <input type="button" value="Salvar" class="botaoEnviar" onclick="enviarCliente()">
                        </div>
                  </form>
              </div>

              <div class="cadastroBox">
                  <div class="cadastroBox1">
                      <span style="color: #465640; font-weight: bold; font-size: 35px;">Fazenda:</span>
                  </div>
                  <form action="" method="" id="formFazenda">
                      <div class="area">
                          <input type="text" name="cep" id="" required class="campoCadastro input"
                              placeholder=" CEP:">
                          <div class="labelline">CEP</div>
                      </div>

                      <div class="area">
                          <input type="text" name="rua" id="" required class="campoCadastro input"
                              placeholder=" Rua:">
                          <div class="labelline">Rua</div>
                      </div>

                      <div class="area">
                          <input type="text" name="logradouro" id="" required class="campoCadastro input"
                              placeholder=" Logradouro:">
                          <div class="labelline">Logradouro</div>
                      </div>

                      <div class="area">
                          <input type="text" name="numero" id="" required class="campoCadastro input"
                              placeholder=" Número:">
                          <div class="labelline">Número</div>
                      </div>

                      <div class="area">
                          <input type="text" name="estado" id="" required class="campoCadastro input"
                              placeholder=" Estado:">
                          <div class="labelline">Estado</div>
                      </div>

                      <div class="area">
                          <input type="text" name="cidade" id="" required class="campoCadastro input"
                              placeholder=" Cidade:">
                          <div class="labelline">Cidade</div>
                      </div>

                      <div class="area">
                          <input type="text" name="comedouro" id="" required class="campoCadastro input"
                              placeholder=" Comedouros:">
                          <div class="labelline">Quantidade</div>
                      </div>

                      <div class="area">
                          <input type="text" name="piquete" id="" required class="campoCadastro input"
                              placeholder=" Piquetes:">
                          <div class="labelline">Quantidade</div>
                      </div>

                      <div class="area">
                          <input type="text" name="bebedouro" id="" required class="campoCadastro input"
                              placeholder=" Bebedouros:">
                          <div class="labelline">Quantidade</div>
                      </div>

                      <div class="area">
                          <input type="text" name="estoque" id="" required class="campoCadastro input"
                              placeholder=" Estoque:">
                          <div class="labelline">Kg de alimento</div>
                      </div>

                      <div class="area">
                          <input type="text" name="sensor" id="" required class="campoCadastro input"
                              placeholder=" Sensores:">
                          <div class="labelline">Quantidade</div>
                      </div>

                      <div class="area">
                          <input type="text" name="metros" id="" required class="campoCadastro input"
                              placeholder=" Metros:">
                          <div class="labelline">Km</div>
                      </div>

                   

                      <div class="botaoContainer">
                          <input type="button" value="Salvar" class="botaoEnviar" onclick="enviarFazenda()">
                        </div>


                  </form>
              </div>

             

          </div>
      </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="footer-sub">
            <div class="footer-children">
                <div class="entre-em-contato">
                    <p style="color: white;">Entre em </p>
                    <p style="color: white;">Contato</p>
                </div>
                <div class="logo-rede">
                    <div class="facebook"><img src="/IMG/facebook-f-brands.svg" width="16px"></div>
                    <div class="instagram"><img src="/IMG/instagram-brands.svg" width="16px"></div>
                    <div class="whatsaap"><img src="/IMG/whatsapp-brands.svg" width="16px"></div>
                    <div class="linkedin"><img src="/IMG/linkedin-in-brands.svg" width="16px"></div>
                </div>
            </div>
            <div class="img-gado">
                <img src="/IMG/1-removebg-preview 3.png" alt="">
            </div>
        </div>

        <div class="divis">
            <hr class="divisao">
        </div>
        <center style="color: white; opacity: 0.5; padding: 0.5%; font-size: small;"><p>© 2025 Todos os direitos reservados. ConectaBov</p></center>
    </div>
    <div id="entreemcontato"></div>

</body>

<script>
    let clienteEnviado = false;
    let fazendaEnviada = false;
    
    // Envio do cliente (com imagem)
    async function enviarCliente() {
      const form = document.getElementById("formCliente");
      const formData = new FormData(form); // necessário para enviar arquivos
      const token = localStorage.getItem("token");
    
      try {
        const resposta = await fetch("http://localhost:3000/client/cliente", {
          method: "POST",
          headers: { "Authorization": `Bearer ${token}` }, // NÃO definir Content-Type
          body: formData
        });
    
        if (resposta.ok) {
          alert("Cliente cadastrado com sucesso!");
          form.reset();
          clienteEnviado = true;
          verificarRedirecionamento();
        } else {
          alert("Erro ao cadastrar cliente.");
        }
      } catch (err) {
        console.error("Erro ao enviar cliente:", err);
        alert("Erro ao cadastrar cliente.");
      }
    }
    
    // Envio da fazenda (JSON)
    async function enviarFazenda() {
      const form = document.getElementById("formFazenda");
      const dados = Object.fromEntries(new FormData(form)); // converte para objeto
      const token = localStorage.getItem("token");
    
      try {
        const resposta = await fetch("http://localhost:3000/client/fazenda", {
          method: "POST",
          headers: { 
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json" // agora sim, JSON
          },
          body: JSON.stringify(dados)
        });
    
        if (resposta.ok) {
          alert("Fazenda cadastrada com sucesso!");
          form.reset();
          fazendaEnviada = true;
          verificarRedirecionamento();
        } else {
          alert("Erro ao cadastrar fazenda.");
        }
      } catch (err) {
        console.error("Erro ao enviar fazenda:", err);
        alert("Erro ao cadastrar fazenda.");
      }
    }
    
    // Redireciona quando ambos forem enviados
    function verificarRedirecionamento() {
      if (clienteEnviado && fazendaEnviada) {
        window.location.href = "perfil.html"; // página de destino
      }
    }
    </script>
<script src="/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="../js/script.js"></script>

</html>