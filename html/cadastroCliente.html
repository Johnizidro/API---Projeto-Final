<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/cadastroCliente.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <title>Cadastro Animal - ConectaBov</title>
</head>

<body>
    <div class="cabecalho">
        <div class="cabecalho-div-">
            <div class="cabecalho-div-login">
                <div class="cabecalho-children">
            <div class="cabecalho-div">
                <!-- Ícone para abrir o menu -->
                <!-- Ícone para abrir o menu -->
                <span class="cabecalho-icone" onclick="abrirMenu()">
                            <img src="/IMG/1-removebg-preview 4.png" width="150px">
                        </span>

                <!-- Menu lateral com botão de fechar -->
                <div id="menuLateral" class="menu-lateral">
                    <button class="fechar-menu" onclick="fecharMenu()">← Voltar</button>
                    <ul>
                        <li>
                            <a href="../index.html">
                                <img src="/IMG/cardapio 2.png" alt="Início" class="icon"> Início
                            </a>
                        </li>
                        <li>
                            <a href="cadastroAnimal.html">
                                <img src="/IMG/cadastro 2.png" alt="Cadastro" class="icon"> Cadastro
                            </a>
                        </li>
                        <li>
                            <a href="consultaMensal.html">
                                <img src="/IMG/pesquisa 2.png" alt="Consulta Mensal" class="icon"> Consulta Mensal
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <img src="/IMG/dia-ensolarado 2.png" alt="Clima" class="icon"> Clima
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <img src="/IMG/telefone 2.png" alt="Contatos" class="icon"
                                    style="width: 50px;margin-left: -6px;"> Contatos
                            </a>
                        </li>
                        <li>
                            <a href="veterinarios.html">
                                <img src="/IMG/vaca 2.png" alt="Veterinários" class="icon"
                                    style="width: 50px;margin-left: -6px;"> Veterinários
                            </a>
                        </li>
                    </ul>
                </div>


            </div>
        </div>
                <div class="pesquisa-dad"><input class="pesquisa" type="text" name="" id="" size="80px"><img
                        class="lupa" src="/IMG/magnifying-glass-solid.svg" alt="" srcset="" width="18px"></div>
                        <a href="perfil.html" class="icon-login"><img class="user-solid" src="/IMG/user-solid.svg" alt="" srcset="" width="30px">
                    <p id="nome-usuario" style="color: #5E7153;font-size: 10.5px;font-weight: bold;">Login</p>
                </a>
            </div>
            <div class="dashboard">
                <div class="dashboard-children">
                    <div class="tituloCadastroGeral">
                        <img src="/IMG/pesquisa 2.png" alt="" width="32px" class="tituloCadastroGeralImg">Cadastro
                        Animal
                    </div>

                    <div class="cadastroBox">
                        <div class="cadastroBox1">
                            <img src="../IMG/vaca (1) 1.png" alt="" width="50px">
                            <span style="color: #465640; font-weight: bold; font-size: 35px; margin-left: 10px;"> Cliente
                               </span>
                        </div>
                        <form action="" method="" id="formCliente">
                            <div class="area">
                                <input type="text" name="nome" id="" required class="campoCadastro input"
                                    placeholder=" Nome Completo">
                                <div class="labelline">Nome Completo</div>
                            </div>

                            <div class="area">
                                <input type="date" name="dataNascimento" id="" required class="campoCadastro input">
                                <div class="labelline">Data de Nascimento</div>
                            </div>

                            <div class="area">
                                <input type="text" name="cnpj" id="" required class="campoCadastro input"
                                    placeholder=" CNPJ">
                                <div class="labelline">CNPJ</div>
                            </div>

                            <div class="area">
                                <input type="text" name="cpf" id="" required class="campoCadastro input"
                                    placeholder=" CPF">
                                <div class="labelline">CPF</div>
                            </div>

                            <div class="area">
                                <input type="text" name="telefone" id="" required class="campoCadastro input"
                                    placeholder=" Telefone">
                                <div class="labelline">Telefone</div>
                            </div>

                            <div class="area">
                                <input type="text" name="ocupacao" id="" required class="campoCadastro input"
                                    placeholder=" Ocupação">
                                <div class="labelline">Ocupação</div>
                            </div>

                            

                            <div class="botaoContainer">
                                <input type="button" value="Salvar" class="botaoEnviar" onclick="enviarCliente()">
                              </div>
                        </form>
                    </div>

                    <div class="cadastroBox">
                        <div class="cadastroBox1">
                            <span style="color: #465640; font-weight: bold; font-size: 35px;">Fazenda:</span>
                        </div>
                        <form action="" method="" id="formFazenda">
                            <div class="area">
                                <input type="text" name="cep" id="" required class="campoCadastro input"
                                    placeholder=" CEP:">
                                <div class="labelline">CEP</div>
                            </div>

                            <div class="area">
                                <input type="text" name="rua" id="" required class="campoCadastro input"
                                    placeholder=" Rua:">
                                <div class="labelline">Rua</div>
                            </div>

                            <div class="area">
                                <input type="text" name="logradouro" id="" required class="campoCadastro input"
                                    placeholder=" Logradouro:">
                                <div class="labelline">Logradouro</div>
                            </div>

                            <div class="area">
                                <input type="text" name="numero" id="" required class="campoCadastro input"
                                    placeholder=" Número:">
                                <div class="labelline">Número</div>
                            </div>

                            <div class="area">
                                <input type="text" name="estado" id="" required class="campoCadastro input"
                                    placeholder=" Estado:">
                                <div class="labelline">Estado</div>
                            </div>

                            <div class="area">
                                <input type="text" name="cidade" id="" required class="campoCadastro input"
                                    placeholder=" Cidade:">
                                <div class="labelline">Cidade</div>
                            </div>

                            <div class="botaoContainer">
                                <input type="button" value="Salvar" class="botaoEnviar" onclick="enviarFazenda()">
                              </div>


                        </form>
                    </div>

                    <div class="swiper">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide">
                                <div class="slide">slide 1</div>
                            </div>
                            <div class="swiper-slide">
                                <div class="slide">slide 2</div>
                            </div>
                            <div class="swiper-slide">
                                <div class="slide">slide 3</div>
                            </div>
                            <div class="swiper-slide">
                                <div class="slide">slide 4</div>
                            </div>
                        </div>
                        <div class="swiper-button-prev"></div>
                        <div class="swiper-button-next"></div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="footer-sub">
            <div class="footer-children">
                <div class="entre-em-contato">
                    <p style="color: white;">Entre em </p>
                    <p style="color: white;">Contato</p>
                </div>
                <div class="logo-rede">
                    <div class="facebook"><img src="/IMG/facebook-f-brands.svg" width="16px"></div>
                    <div class="instagram"><img src="/IMG/instagram-brands.svg" width="16px"></div>
                    <div class="whatsaap"><img src="/IMG/whatsapp-brands.svg" width="16px"></div>
                    <div class="linkedin"><img src="/IMG/linkedin-in-brands.svg" width="16px"></div>
                </div>
            </div>
            <div class="img-gado">
                <img src="/IMG/1-removebg-preview 3.png" alt="">
            </div>
        </div>

        <div class="divis">
            <hr class="divisao">
        </div>
        <center style="color: white; opacity: 0.5; padding: 0.5%; font-size: small;"><p>© 2025 Todos os direitos reservados. ConectaBov</p></center>
    </div>
    <div id="entreemcontato"></div>

</body>
<script>
    let clienteEnviado = false;
    let fazendaEnviada = false;
    
    // Envio do cliente
    async function enviarCliente() {
      const form = document.getElementById("formCliente");
      const dados = Object.fromEntries(new FormData(form));
      const token = localStorage.getItem('token'); // PEGAR O TOKEN
      const resposta = await fetch("http://localhost:3000/auth/cliente", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`  // ENVIAR O TOKEN AQUI
        },
        body: JSON.stringify(dados)
      });
    
      if (resposta.ok) {
        alert("Cliente cadastrado com sucesso!");
        form.reset();
        clienteEnviado = true;
        verificarRedirecionamento();
      } else {
        alert("Erro ao cadastrar cliente.");
      }
    }
    
    // Envio da fazenda
    async function enviarFazenda() {
      const form = document.getElementById("formFazenda");
      const dados = Object.fromEntries(new FormData(form));
      const token = localStorage.getItem('token');
      const resposta = await fetch("http://localhost:3000/auth/fazenda", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`  // MESMA CORREÇÃO AQUI
        },
        body: JSON.stringify(dados)
      });
    
      if (resposta.ok) {
        alert("Fazenda cadastrada com sucesso!");
        form.reset();
        fazendaEnviada = true;
        verificarRedirecionamento();
      } else {
        alert("Erro ao cadastrar fazenda.");
      }
    }
    
    function verificarRedirecionamento() {
      if (clienteEnviado && fazendaEnviada) {
        window.location.href = "http://127.0.0.1:5500/html/servicos.html";
      }
    }
    
    window.addEventListener('DOMContentLoaded', async () => {
      const token = localStorage.getItem('token');
      if (!token) return;
    
      try {
        const res = await fetch('http://localhost:3000/auth/me', {
          method: 'GET',
          headers: {
            Authorization: `Bearer ${token}`
          }
        });
    
        if (res.ok) {
          const user = await res.json();
          const nomeUsuario = document.getElementById('nome-usuario');
          if (nomeUsuario) nomeUsuario.textContent = user.name;
        } else {
          console.warn("Token inválido ou usuário não encontrado");
        }
      } catch (err) {
        console.error("Erro ao buscar dados do usuário:", err);
      }
    });
    </script>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="../js/script.js"></script>

</html>