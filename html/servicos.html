<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/servicos.css">
    <link rel="shortcut icon" href="../IMG/Group 5.png" type="image/x-icon">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>ConectaBov</title>
</head>

<body>
    <div class="cabecalho">
        <div class="cabecalho-div-">
            <div class="cabecalho-div-login">
                <img src="/IMG/Group 5.png" width="80px" class="imgLogo">      
                <div class="cabecalho-div">
                    <div id="menuLateral" class="menu-lateral">
                        <button class="fechar-menu" onclick="fecharMenu()">← Voltar</button>
                        <ul>
                            <li>
                                <a href="servicos.html">
                                    <img src="/IMG/cardapio 2.png" alt="Início" class="icon"> Início
                                </a>
                            </li>
                            <li>
                                <a href="cadastroAnimal.html">
                                    <img src="/IMG/cadastro 2.png" alt="Cadastro" class="icon"> Cadastro
                                </a>
                            </li>
                            <li>
                                <a href="consultaMensal.html">
                                    <img src="/IMG/pesquisa 2.png" alt="Consulta Mensal" class="icon"> Consulta Mensal
                                </a>
                            </li>
                            <li>
                                <a href="/public/CLimaAPI.html">
                                    <img src="/IMG/dia-ensolarado 2.png" alt="Clima" class="icon"> Clima
                                </a>
                            </li>
                            <li>
                                <a href="veterinarios.html">
                                    <img src="/IMG/vaca 2.png" alt="Veterinários" class="icon"
                                        style="width: 50px;margin-left: -6px;"> Veterinários
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="logout()" style="display: flex; align-items: center;">
                                    ←  Sair
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <a href="perfil.html" class="icon-login">
                    <img class="user-solid" src="/IMG/user-solid.svg" alt="" width="30px">
                </a>
            </div>

            <div class="menu">
                <img src="/IMG/bars-solid-full.svg" alt="" width="35px" onclick="abrirMenu()">
                <p>Bem vindo a ConectaBov</p>
            </div>

            <div class="chat-container">
                <button class="chat-btn" id="chatBtn">
                  <img src="../img/scarecrow (1) 1.png" alt="Chat ConectaBov">
                </button>
                <div class="chat-box" id="chatBox">
                  <div class="chat-header">
                    ConectaBov I.A
                    <span class="close-chat" id="closeChat">✖</span>
                  </div>
                  <div class="chat-messages" id="chatMessages">
                    <p class="bot-msg">Olá! Eu sou a I.A da ConectaBov, como posso ajudar?</p>
                  </div>
                  <div class="chat-input">
                    <input type="text" id="userInput" placeholder="Digite sua mensagem...">
                    <button id="sendBtn">➤</button>
                  </div>
                </div>
            </div>

            <div class="dashboard">
                <div class="dashboard-children">
                    <div class="registro-fileira1">

                        <!-- Animais: não mexer -->
                        <div class="registro-gado">
                            <div class="registro-gado-dado">
                                <div class="register-number">
                                    <h1 class="colorh1" id="contador-gado">4</h1>
                                </div>
                                <img src="/IMG/imgDashBoard/vaca (1) 1.png" width="70px" height="70px">
                            </div>
                            <h3 class="colorh3">Gado</h3>
                        </div>

                        <!-- Campos novos: atualizáveis -->
                        <div class="registro-comedouros">
                            <div class="registro-gado-dado">
                                <div class="register-number">
                                    <h1 class="colorh1">0.0</h1>
                                </div>
                                <img src="/IMG/imgDashBoard/trigo 1.png" width="70px" height="70px">
                            </div>
                            <h3 class="colorh3">Comedouros</h3>
                        </div>

                        <div class="registro-bebedouros">
                            <div class="registro-gado-dado">
                                <div class="register-number">
                                    <h1 class="colorh1">0.0</h1>
                                </div>
                                <img src="/IMG/imgDashBoard/gota-de-agua 1.png" width="70px" height="70px">
                            </div>
                            <h3 class="colorh3">Bebedouros</h3>
                        </div>

                        <div class="registro-metros">
                            <div class="registro-gado-dado">
                                <div class="register-number">
                                    <h1 class="colorh1">0.0</h1>
                                </div>
                                <img src="/IMG/imgDashBoard/area 1.png" width="70px" height="70px">
                            </div>
                            <h3 class="colorh3">Metros</h3>
                        </div>

                        <div class="registro-sensores">
                            <div class="registro-gado-dado">
                                <div class="register-number">
                                    <h1 class="colorh1">0.0</h1>
                                </div>
                                <img src="/IMG/imgDashBoard/sensor 1.png" width="70px" height="70px">
                            </div>
                            <h3 class="colorh3">Sensores</h3>
                        </div>

                        <div class="regitro-piquetes">
                            <div class="registro-gado-dado">
                                <div class="register-number">
                                    <h1 class="colorh1">0.0</h1>
                                </div>
                                <img src="/IMG/imgDashBoard/piquete 1.png" width="70px" height="70px">
                            </div>
                            <h3 class="colorh3">Piquetes</h3>
                        </div>

                        <div class="registro-estoque">
                            <div class="registro-gado-dado">
                                <div class="register-number">
                                    <h1 class="colorh1">0.0</h1>
                                </div>
                                <img src="/IMG/imgDashBoard/pacote-de-feno (1) 1.png" width="70px" height="70px">
                            </div>
                            <h3 class="colorh3">Estoque</h3>
                        </div>

                        <div class="registro-rodizio">
                            <div class="registro-gado-dado">
                                <div class="register-number">
                                    <h1 class="colorh1">0.0</h1>
                                </div>
                                <img src="/IMG/imgDashBoard/troca 1.png" width="70px" height="70px">
                            </div>
                            <h3 class="colorh3">Rodízio</h3>
                        </div>

                    </div>

                    <!-- Div de gráficos: mantida -->
                    <div class="registro-graficos"></div>

                </div>
            </div>
        </div>
    </div>

    <div class="b3">
        <img src="../IMG/Sem Título-1.png" alt="" width="60%">
    </div>

    <div class="footer">
        <div class="footer-sub">
            <div class="footer-children">
                <div class="entre-em-contato">
                    <p style="color: white;">Entre em </p>
                    <p style="color: white;">Contato</p>
                </div>
                <div class="logo-rede">
                    <div class="facebook"><img src="/IMG/facebook-f-brands.svg" width="16px"></div>
                    <div class="instagram"><img src="/IMG/instagram-brands.svg" width="16px"></div>
                    <div class="whatsaap"><img src="/IMG/whatsapp-brands.svg" width="16px"></div>
                    <div class="linkedin"><img src="/IMG/linkedin-in-brands.svg" width="16px"></div>
                </div>
            </div>
            <div class="img-gado">
                <img src="/IMG/1-removebg-preview 3.png" alt="">
            </div>
        </div>

        <div class="divis">
            <hr class="divisao">
        </div>
        <center style="color: white; opacity: 0.5; padding: 0.5%; font-size: small;">
            <p>© 2025 Todos os direitos reservados. ConectaBov</p>
        </center>
    </div>
    <div id="entreemcontato"></div>

</body>

<script>
window.addEventListener('DOMContentLoaded', async () => {
  const token = localStorage.getItem('token');
  if (!token) return;

  try {
    const res = await fetch('http://localhost:3000/auth/me', {
      method: 'GET',
      headers: { Authorization: `Bearer ${token}` }
    });

    if (!res.ok) throw new Error('Erro ao buscar dados do usuário');

    const data = await res.json();
    const fazenda = data.fazenda || {};

    const camposDashboard = {
      'registro-comedouros': 'comedouro',
      'registro-bebedouros': 'bebedouro',
      'registro-metros': 'metros',
      'registro-sensores': 'sensor',
      'regitro-piquetes': 'piquete',
      'registro-estoque': 'estoque',
      'registro-rodizio': 'rodizio'
    };

    Object.entries(camposDashboard).forEach(([classeDiv, campoFazenda]) => {
      const div = document.querySelector(`.${classeDiv}`);
      if (div) {
        const h1 = div.querySelector('h1');
        if (h1) {
          h1.textContent = fazenda[campoFazenda] || 0; // Se não tiver, mostra 0
        }
      }
    });

  } catch (err) {
    console.error('Erro ao atualizar dashboard:', err);
  }
});

</script>

<script src="/js/main.js"></script>
<script src="/js/script.js"></script>
<script src="/js/servicos.js"></script>

</html>
