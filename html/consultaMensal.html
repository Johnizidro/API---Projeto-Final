<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/ConsultaAnimal.css">
    <link rel="shortcut icon" href="../IMG/Group 5.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <title>ConectaBov</title>
</head>

<body>
  <div class="cabecalho">
    <div class="cabecalho-div-">
        <div class="cabecalho-div-login">
            <img src="/IMG/Group 5.png" width="80px" class="imgLogo">      
                <div class="cabecalho-div">
                    <!-- √çcone para abrir o menu -->
                    <!-- √çcone para abrir o menu -->
                    
                    <!-- Menu lateral com bot√£o de fechar -->
                    <div id="menuLateral" class="menu-lateral">
                        <button class="fechar-menu" onclick="fecharMenu()">‚Üê Voltar</button>
                        <ul>
                            <li>
                                <a href="servicos.html">
                                    <img src="/IMG/cardapio 2.png" alt="In√≠cio" class="icon"> In√≠cio
                                </a>
                            </li>
                            <li>
                                <a href="cadastroAnimal.html">
                                    <img src="/IMG/cadastro 2.png" alt="Cadastro" class="icon"> Cadastro
                                </a>
                            </li>
                            <li>
                                <a href="consultaMensal.html">
                                    <img src="/IMG/pesquisa 2.png" alt="Consulta Mensal" class="icon"> Consulta
                                    Mensal
                                </a>
                            </li>
                            <li>
                              <a href="/public/CLimaAPI.html">
                                    <img src="/IMG/dia-ensolarado 2.png" alt="Clima" class="icon"> Clima
                                </a>
                            </li>
                         
                            <li>
                                <a href="veterinarios.html">
                                    <img src="/IMG/vaca 2.png" alt="Veterin√°rios" class="icon"
                                        style="width: 50px;margin-left: -6px;"> Veterin√°rios
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
       

            <div class="pesquisa-dad">
                <input class="pesquisa" type="text" name="" id="" size="80px">
                <img class="lupa" src="/IMG/magnifying-glass-solid.svg" alt="" srcset="" width="18px">
            </div>

            <a href="perfil.html" class="icon-login"><img class="user-solid" src="/IMG/user-solid.svg" alt="" srcset="" width="30px">
               
            </a>
        </div>
        
        <div class="menu">
            <img src="/IMG/bars-solid-full.svg" alt="" width="35px" onclick="abrirMenu()">
            <p>Bem vindo a ConectaBov</p>
        </div>

        <div class="chat-container">
          <!-- Bot√£o aparece s√≥ quando o chat est√° fechado -->
          <button class="chat-btn" id="chatBtn">
            <img src="../img/scarecrow (1) 1.png" alt="Chat ConectaBov">
          </button>
        
          <!-- Caixa de chat escondida inicialmente -->
          <div class="chat-box" id="chatBox">
            <div class="chat-header">
              ConectaBov I.A
              <span class="close-chat" id="closeChat">‚úñ</span>
            </div>
            <div class="chat-messages" id="chatMessages">
              <p class="bot-msg">Ol√°! Eu sou a I.A da ConectaBov, como posso ajudar?</p>
            </div>
            <div class="chat-input">
              <input type="text" id="userInput" placeholder="Digite sua mensagem...">
              <button id="sendBtn">‚û§</button>
            </div>
          </div>
        </div>

         
          
        <div class="dashboard">
          <div class="dashboard-children">

              <section class="secao-consulta">
                  <div class="titulo-consulta">
                      <img src="/IMG/pesquisa 2.png" class="icone" width="35px">
                      <span style="color: white;font-weight: bold;font-size: 30px;">Consulta Mensal</span>
                  </div>

                  <div class="painel-topo">
                      <div class="quantidade">
                          <span class="numero">0.0</span>
                          <span class="texto">animais</span>
                          <img src="/IMG/vaca (1) 1.png" class="icone-cabeca" style=" width: 45px; margin-left:5px">
                      </div>
                      <div class="campo-busca">
                          <div class="pesquisa-dad">
                              <input class="pesquisa" type="text" name="" id="" placeholder="C√≥digo Sisbov"
                                  size="30px">
                              <img class="lupa" src="/IMG/magnifying-glass-solid.svg" alt="" srcset=""
                                  width="18px">
                          </div>
                      </div>
                  </div>

                  <div class="lista-animais">
                      <div class="item-animal"></div>
                  </div>
              </section>


          </div>
      </div>
        </div>
    </div>
    <div class="footer">
        <div class="footer-sub">
            <div class="footer-children">
                <div class="entre-em-contato">
                    <p style="color: white;">Entre em </p>
                    <p style="color: white;">Contato</p>
                </div>
                <div class="logo-rede">
                    <div class="facebook"><img src="/IMG/facebook-f-brands.svg" width="16px"></div>
                    <div class="instagram"><img src="/IMG/instagram-brands.svg" width="16px"></div>
                    <div class="whatsaap"><img src="/IMG/whatsapp-brands.svg" width="16px"></div>
                    <div class="linkedin"><img src="/IMG/linkedin-in-brands.svg" width="16px"></div>
                </div>
            </div>
            <div class="img-gado">
                <img src="/IMG/1-removebg-preview 3.png" alt="">
            </div>
        </div>

        <div class="divis">
            <hr class="divisao">
        </div>
        <center style="color: white; opacity: 0.5; padding: 0.5%; font-size: small;"><p>¬© 2025 Todos os direitos reservados. ConectaBov</p></center>
    </div>
    <div id="entreemcontato"></div>

</body>

<script>
  window.addEventListener('DOMContentLoaded', async () => {
    const token = localStorage.getItem('token');
    if (!token) {
      alert('Usu√°rio n√£o autenticado. Fa√ßa login.');
      window.location.href = 'login.html';
      return;
    }

    try {
      const res = await fetch('http://localhost:3000/tarefas/listaAni', {
        headers: { Authorization: `Bearer ${token}` }
      });

      if (!res.ok) throw new Error('Erro ao buscar animais');

      const animais = await res.json();

      // Atualiza a contagem de animais
      const numeroAnimais = document.querySelector('.quantidade .numero');
      if (numeroAnimais) numeroAnimais.textContent = animais.length;

      const lista = document.querySelector('.lista-animais');
      lista.innerHTML = ''; // limpa os itens anteriores

      // Renderiza cada animal com bot√µes
      animais.forEach(animal => {
        const div = document.createElement('div');
        div.classList.add('item-animal');

        div.innerHTML = `
          <div class="campo"><strong>Nome:</strong> ${animal.nome}</div>
          <div class="campo"><strong>C√≥digo Sisbov:</strong> ${animal.codigoSisbov}</div>
          <div class="campo"><strong>Sexo:</strong> ${animal.sexo}</div>
          <div class="campo"><strong>Tipo Produ√ß√£o:</strong> ${animal.tipoProducao}</div>
          <div class="campo"><strong>Peso:</strong> ${animal.peso} kg</div>
          <div class="campo"><strong>Altura:</strong> ${animal.altura} m</div>
          <div class="acoes">
            <button class="btn-editar" data-id="${animal._id}">‚úèÔ∏è Editar</button>
            <button class="btn-deletar" data-id="${animal._id}">üóëÔ∏è Deletar</button>
          </div>
        `;

        lista.appendChild(div);
      });

      // Eventos dos bot√µes
      lista.addEventListener('click', async (e) => {
        const target = e.target;

        // üóëÔ∏è DELETAR
        if (target.classList.contains('btn-deletar')) {
          const id = target.getAttribute('data-id');
          if (confirm('Deseja realmente deletar este animal?')) {
            try {
              const res = await fetch(`http://localhost:3000/tarefas/deletar/${id}`, {
                method: 'DELETE',
                headers: {
                  Authorization: `Bearer ${token}`
                }
              });

              if (!res.ok) throw new Error('Erro ao deletar animal');

              alert('Animal deletado com sucesso!');
              location.reload(); // recarrega a lista

            } catch (error) {
              console.error(error);
              alert('Erro ao deletar animal');
            }
          }
        }

        // ‚úèÔ∏è EDITAR
        if (target.classList.contains('btn-editar')) {
          const id = target.getAttribute('data-id');
          window.location.href = `EditarAnimal.html?id=${id}`;
        }
      });

    } catch (error) {
      console.error(error);
      alert('Erro ao carregar animais');
    }
  });
</script>

<script src="/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="../js/script.js"></script>

</html>