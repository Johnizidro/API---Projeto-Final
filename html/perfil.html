<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/perfil.css">
    <link rel="shortcut icon" href="../IMG/Group 5.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <title>ConectaBov</title>
</head>

<body>
  <div class="cabecalho">
    <div class="cabecalho-div-">
        <div class="cabecalho-div-login">
            <img src="/IMG/Group 5.png" width="80px" class="imgLogo">      
                <div class="cabecalho-div">
                    <!-- Ícone para abrir o menu -->
                    <!-- Ícone para abrir o menu -->
                    
                    <!-- Menu lateral com botão de fechar -->
                    <div id="menuLateral" class="menu-lateral">
                        <button class="fechar-menu" onclick="fecharMenu()">← Voltar</button>
                        <ul>
                            <li>
                                <a href="servicos.html">
                                    <img src="/IMG/cardapio 2.png" alt="Início" class="icon"> Início
                                </a>
                            </li>
                            <li>
                                <a href="cadastroAnimal.html">
                                    <img src="/IMG/cadastro 2.png" alt="Cadastro" class="icon"> Cadastro
                                </a>
                            </li>
                            <li>
                                <a href="consultaMensal.html">
                                    <img src="/IMG/pesquisa 2.png" alt="Consulta Mensal" class="icon"> Consulta
                                    Mensal
                                </a>
                            </li>
                            <li>
                                <a href="/public/CLimaAPI.html">
                                    <img src="/IMG/dia-ensolarado 2.png" alt="Clima" class="icon"> Clima
                                </a>
                            </li>
                         
                            <li>
                                <a href="veterinarios.html">
                                    <img src="/IMG/vaca 2.png" alt="Veterinários" class="icon"
                                        style="width: 50px;margin-left: -6px;"> Veterinários
                                </a>
                                <li>
                                  <a
                                    href="#"
                                    onclick="logout()"
                                  
                                    ><img
                                  src="/IMG/exit (1).png"
                                  class="icon"
                                  style="width: 30px;"
                                />
                                Logout
                                  </a>
                                </li>  
                        </ul>
                    </div>
                </div>
       

            

            <a href="perfil.html" class="icon-login"><img class="user-solid" src="/IMG/user-solid.svg" alt="" srcset="" width="35px">
               
            </a>
        </div>
        
        <div class="menu">
            <img src="/IMG/bars-solid-full.svg" alt="" width="35px" onclick="abrirMenu()">
            <p>Bem vindo a ConectaBov</p>
        </div>

        <div class="chat-container">
          <!-- Botão aparece só quando o chat está fechado -->
          <button class="chat-btn" id="chatBtn">
            <img src="../img/scarecrow (1) 1.png" alt="Chat ConectaBov">
          </button>
        
          <!-- Caixa de chat escondida inicialmente -->
          <div class="chat-box" id="chatBox">
            <div class="chat-header">
              ConectaBov I.A
              <span class="close-chat" id="closeChat">✖</span>
            </div>
            <div class="chat-messages" id="chatMessages">
              <p class="bot-msg">Olá! Eu sou a I.A da ConectaBov, como posso ajudar?</p>
            </div>
            <div class="chat-input">
              <input type="text" id="userInput" placeholder="Digite sua mensagem...">
              <button id="sendBtn">➤</button>
            </div>
          </div>
        </div>

         
          
        <div class="dashboard">
          <div class="dashboard-children">
            

           

              <div class="cadastroBox">
                  <div class="cadastroBox1">
                      <span style="color: #465640; font-weight: bold; font-size: 35px;">Dados Gerais:</span>
                  </div>

<div class="perfil-foto-container">
<img id="fotoPerfil" class="perfil-foto" src="/IMG/user-solid.svg" alt="Foto de Perfil">
</div>

                  <div class="perfil-box">
                      <span style="color: #465640; font-weight: bold; font-size: 25px;">Cliente:</span>
                      <div class="perfil-secao">
                          
                          <div class="perfil-item">
                              
                              <span class="perfil-label">Nome:</span>
                              <span id="nome">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">E-mail:</span>
                              <span id="email">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">Data de Cadastro:</span>
                              <span id="dataCadastro">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">Data de Nascimento:</span>
                              <span id="dataNascimento">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">CNPJ:</span>
                              <span id="cnpj">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">CPF:</span>
                              <span id="cpf">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">Telefone:</span>
                              <span id="telefone">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">Ocupação:</span>
                              <span id="ocupacao">...</span>
                          </div>
                      </div>
                  
                      <span style="color: #465640; font-weight: bold; font-size: 25px; margin-top:5% ;">Fazenda:</span>
                      <div class="perfil-secao">
                          <div class="perfil-item">
                              <span class="perfil-label">CEP:</span>
                              <span id="cep">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">Rua:</span>
                              <span id="rua">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">Logradouro:</span>
                              <span id="logradouro">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">Número:</span>
                              <span id="numero">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">Estado:</span>
                              <span id="estado">...</span>
                          </div>
                          <div class="perfil-item">
                              <span class="perfil-label">Cidade:</span>
                              <span id="cidade">...</span>
                          </div>
                          <div class="perfil-item">
  <span class="perfil-label">Comedouros:</span>
  <span id="comedouro">...</span>
</div>
<div class="perfil-item">
  <span class="perfil-label">Piquetes:</span>
  <span id="piquete">...</span>
</div>
<div class="perfil-item">
  <span class="perfil-label">Bebedouros:</span>
  <span id="bebedouro">...</span>
</div>
<div class="perfil-item">
  <span class="perfil-label">Estoque (Kg):</span>
  <span id="estoque">...</span>
</div>
<div class="perfil-item">
  <span class="perfil-label">Sensores:</span>
  <span id="sensor">...</span>
</div>
<div class="perfil-item">
  <span class="perfil-label">Tamanho (m²):</span>
  <span id="metros">...</span>
</div>
                      </div>
                  </div>
                  <div style="margin-top: 20px; text-align: center;">
<button id="editarPerfilBtn" class="botaoEnviar">Editar Perfil</button>
</div>
              </div>
          </div>
        </div>
    </div>
    <div class="footer">
        <div class="footer-sub">
            <div class="footer-children">
                <div class="entre-em-contato">
                    <p style="color: white;">Entre em </p>
                    <p style="color: white;">Contato</p>
                </div>
                <div class="logo-rede">
                    <div class="facebook"><img src="/IMG/facebook-f-brands.svg" width="16px"></div>
                    <div class="instagram"><img src="/IMG/instagram-brands.svg" width="16px"></div>
                    <div class="whatsaap"><img src="/IMG/whatsapp-brands.svg" width="16px"></div>
                    <div class="linkedin"><img src="/IMG/linkedin-in-brands.svg" width="16px"></div>
                </div>
            </div>
            <div class="img-gado">
                <img src="/IMG/1-removebg-preview 3.png" alt="">
            </div>
        </div>

        <div class="divis">
            <hr class="divisao">
        </div>
        <center style="color: white; opacity: 0.5; padding: 0.5%; font-size: small;"><p>© 2025 Todos os direitos reservados. ConectaBov</p></center>
    </div>
    <div id="entreemcontato"></div>



    <script>
        window.addEventListener('DOMContentLoaded', async () => {
          const token = localStorage.getItem('token');
          if (!token) return;
        
          try {
            const res = await fetch('http://localhost:3000/auth/me', {
              method: 'GET',
              headers: {
                Authorization: `Bearer ${token}`
              }
            });
        
            if (!res.ok) {
              console.error('Erro ao buscar os dados do usuário.');
              return;
            }
        
            const data = await res.json();
            console.log(data);
            const user = data.user || {};
            const cliente = data.cliente || {};
            const fazenda = data.fazenda || {};
        
            // ===== Dados do usuário =====
            document.getElementById('nome').textContent = user.name || '---';
            document.getElementById('email').textContent = user.email || '---';
            document.getElementById('dataCadastro').textContent = user.createdAt
              ? new Date(user.createdAt).toLocaleDateString('pt-BR')
              : '---';
            document.getElementById('telefone').textContent = user.telefone || '---';
        
            // ===== Dados do cliente =====
            document.getElementById('dataNascimento').textContent = cliente.dataNascimento || '---';
            document.getElementById('cnpj').textContent = cliente.cnpj || '---';
            document.getElementById('cpf').textContent = cliente.cpf || '---';
            document.getElementById('ocupacao').textContent = cliente.ocupacao || '---';
        
            // ===== Imagem do cliente =====
            if (cliente.imagem) {
              const fotoPerfil = document.getElementById('fotoPerfil');
              fotoPerfil.src = `data:image/png;base64,${cliente.imagem}`;
            }
        
            // ===== Dados da fazenda =====
            document.getElementById('cep').textContent = fazenda.cep || '---';
            document.getElementById('rua').textContent = fazenda.rua || '---';
            document.getElementById('logradouro').textContent = fazenda.logradouro || '---';
            document.getElementById('numero').textContent = fazenda.numero || '---';
            document.getElementById('estado').textContent = fazenda.estado || '---';
            document.getElementById('cidade').textContent = fazenda.cidade || '---';
            document.getElementById('comedouro').textContent = fazenda.comedouro ?? '---';
            document.getElementById('piquete').textContent = fazenda.piquete ?? '---';
            document.getElementById('bebedouro').textContent = fazenda.bebedouro ?? '---';
            document.getElementById('estoque').textContent = fazenda.estoque ?? '---';
            document.getElementById('sensor').textContent = fazenda.sensor ?? '---';
            document.getElementById('metros').textContent = fazenda.metros ?? '---';
        
          } catch (error) {
            console.error('Erro na requisição:', error);
          }
        
          // Botão de edição de perfil
          document.getElementById("editarPerfilBtn").addEventListener("click", () => {
            window.location.href = "http://127.0.0.1:5500/html/EdicaoCliente%20copy.html";
          });
        });
        </script>
      

</body>


<script src="/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="../js/script.js"></script>

</html>